!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.accedoOne=t()}(this,function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}for(var t=e(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}}),r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);var o,i,a=function(e,t){var n=t||0,o=r;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]},s=0,c=0;var u=function(e,r,n){var u=r&&n||0,l=r||[],p=(e=e||{}).node||o,f=void 0!==e.clockseq?e.clockseq:i;if(null==p||null==f){var d=t();null==p&&(p=o=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==f&&(f=i=16383&(d[6]<<8|d[7]))}var v=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,y=v-s+(g-c)/1e4;if(y<0&&void 0===e.clockseq&&(f=f+1&16383),(y<0||v>s)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=v,c=g,i=f;var h=(1e4*(268435455&(v+=122192928e5))+g)%4294967296;l[u++]=h>>>24&255,l[u++]=h>>>16&255,l[u++]=h>>>8&255,l[u++]=255&h;var m=v/4294967296*1e4&268435455;l[u++]=m>>>8&255,l[u++]=255&m,l[u++]=m>>>24&15|16,l[u++]=m>>>16&255,l[u++]=f>>>8|128,l[u++]=255&f;for(var b=0;b<6;++b)l[u+b]=p[b];return r||a(l)};var l=function(e,r,n){var o=r&&n||0;"string"==typeof e&&(r="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||t)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var s=0;s<16;++s)r[o+s]=i[s];return r||a(i)},p=l;p.v1=u,p.v4=l;var f=p,d=function(){},v=function(e){return function(t){var r=t.gid,n=t.appKey,o=t.ip,i=t.target,a=t.log;void 0===a&&(a=d);var s=t.onDeviceIdGenerated;void 0===s&&(s=d);var c=t.onSessionKeyChanged;void 0===c&&(c=d);var u=t.deviceId,l=t.sessionKey;if(u||(l=null),!function(e){void 0===e&&(e={});var t=e.appKey,r=e.deviceId,n=e.sessionKey;return t&&!r&&!n||t&&r}({appKey:n,deviceId:u,sessionKey:l}))throw new Error("You must provide an appKey | an appKey and a deviceId | an appKey, a deviceId and a sessionKey");u||s(u=f.v4());var p={deviceId:u,gid:r,ip:o,appKey:n,target:i,log:a,onSessionKeyChanged:c};return Object.defineProperty(p,"sessionKey",{set:function(e){l=e,c(e)},get:function(){return l}}),e.props({config:p}).create()}},g=!1,y=!1;try{g="undefined"!=typeof localStorage,y="undefined"!=typeof sessionStorage}catch(e){}var h=g||y,m=function(){try{return{deviceId:localStorage.ag_d,sessionKey:y?sessionStorage.ag_s:void 0}}catch(e){return{}}},b=function(e){if(g)try{localStorage.ag_d=e}catch(e){}},S=function(e){if(y)try{sessionStorage.ag_s=e}catch(e){}},O=function(e){return function(t){var r=v(e);if(!h)return r(t);var n=t.browserInfoProvider;void 0===n&&(n=m);var o=t.onDeviceIdGenerated;void 0===o&&(o=b);var i=t.onSessionKeyChanged;void 0===i&&(i=S);var a=t.deviceId,s=t.sessionKey;if((!a||!s)&&n){var c=n();a=a||c.deviceId,s=s||c.sessionKey}return r(Object.assign({},t,{deviceId:a,sessionKey:s,onDeviceIdGenerated:o,onSessionKeyChanged:i}))}},w=Array.isArray,j=function(e){return"function"==typeof e},A=function(e){var t=typeof e;return Boolean(e)&&("object"===t||"function"===t)},P=function(e){return j(e)&&j(e.compose)},D=A,L=Object.assign,T=function(e){return Boolean(e)&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype};function K(e,t){if(void 0===t)return e;if(w(t))return(w(e)?e:[]).concat(t);if(!T(t))return t;for(var r=A(e)?e:{},n=Object.keys(t),o=0;o<n.length;o+=1){var i=n[o],a=t[i];if(void 0!==a){var s=r[i],c=T(s)||w(a)?s:{};r[i]=K(c,a)}}return r}var x=function(e){for(var t=arguments,r=1;r<arguments.length;r++)e=K(e,t[r]);return e},E=Array.prototype.slice;function C(e,t){var r=function e(t){var r=arguments,n=e.compose||{},o={__proto__:n.methods};if(x(o,n.deepProperties),L(o,n.properties),Object.defineProperties(o,n.propertyDescriptors||{}),!n.initializers||0===n.initializers.length)return o;void 0===t&&(t={});for(var i=n.initializers,a=i.length,s=0;s<a;s+=1){var c=i[s];if(j(c)){var u=c.call(o,t,{instance:o,stamp:e,args:E.apply(r)});o=void 0===u?o:u}}return o};e.staticDeepProperties&&x(r,e.staticDeepProperties),e.staticProperties&&L(r,e.staticProperties),e.staticPropertyDescriptors&&Object.defineProperties(r,e.staticPropertyDescriptors);var n=j(r.compose)?r.compose:t;return r.compose=function(){return n.apply(this,arguments)},L(r.compose,e),r}function I(e,t,r){if(w(t)){var n=t.length,o=e[r]||[];e[r]=o;for(var i=0;i<n;i+=1){var a=t[i];j(a)&&o.indexOf(a)<0&&o.push(a)}}}function k(e,t,r,n){A(t[r])&&(A(e[r])||(e[r]={}),n(e[r],t[r]))}function H(e,t,r){k(e,t,r,x)}function R(e,t,r){k(e,t,r,L)}function N(e,t){var r=t&&t.compose||t;R(e,r,"methods"),R(e,r,"properties"),H(e,r,"deepProperties"),R(e,r,"propertyDescriptors"),R(e,r,"staticProperties"),H(e,r,"staticDeepProperties"),R(e,r,"staticPropertyDescriptors"),R(e,r,"configuration"),H(e,r,"deepConfiguration"),I(e,r.initializers,"initializers"),I(e,r.composers,"composers")}var B=function e(){var t=arguments,r={},n=[];D(this)&&(N(r,this),n.push(this));for(var o=0;o<arguments.length;o++){var i=t[o];D(i)&&(N(r,i),n.push(i))}var a=C(r,e),s=r.composers;if(w(s)&&s.length>0)for(var c=0;c<s.length;c+=1){var u=(0,s[c])({stamp:a,composables:n});a=P(u)?u:a}return a},z=e(function(e,t){var r=Object.prototype.hasOwnProperty,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();t.arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},t.merge=function(e,n,o){if(!n)return e;if("object"!=typeof n){if(Array.isArray(e))e.push(n);else{if("object"!=typeof e)return[e,n];(o.plainObjects||o.allowPrototypes||!r.call(Object.prototype,n))&&(e[n]=!0)}return e}if("object"!=typeof e)return[e].concat(n);var i=e;return Array.isArray(e)&&!Array.isArray(n)&&(i=t.arrayToObject(e,o)),Array.isArray(e)&&Array.isArray(n)?(n.forEach(function(n,i){r.call(e,i)?e[i]&&"object"==typeof e[i]?e[i]=t.merge(e[i],n,o):e.push(n):e[i]=n}),e):Object.keys(n).reduce(function(e,i){var a=n[i];return r.call(e,i)?e[i]=t.merge(e[i],a,o):e[i]=a,e},i)},t.assign=function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",o=0;o<t.length;++o){var i=t.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?r+=t.charAt(o):i<128?r+=n[i]:i<2048?r+=n[192|i>>6]+n[128|63&i]:i<55296||i>=57344?r+=n[224|i>>12]+n[128|i>>6&63]+n[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(o)),r+=n[240|i>>18]+n[128|i>>12&63]+n[128|i>>6&63]+n[128|63&i])}return r},t.compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],i=o.obj[o.prop],a=Object.keys(i),s=0;s<a.length;++s){var c=a[s],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:i,prop:c}),r.push(u))}return function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var n=[],o=0;o<t.length;++o)void 0!==t[o]&&n.push(t[o]);r.obj[r.prop]=n}}return t}(t)},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),U=(z.arrayToObject,z.merge,z.assign,z.decode,z.encode,z.compact,z.isRegExp,z.isBuffer,String.prototype.replace),q=/%20/g,_={default:"RFC3986",formatters:{RFC1738:function(e){return U.call(e,q,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},F={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},G=Date.prototype.toISOString,V={delimiter:"&",encode:!0,encoder:z.encode,encodeValuesOnly:!1,serializeDate:function(e){return G.call(e)},skipNulls:!1,strictNullHandling:!1},J=function e(t,r,n,o,i,a,s,c,u,l,p,f){var d=t;if("function"==typeof s)d=s(r,d);else if(d instanceof Date)d=l(d);else if(null===d){if(o)return a&&!f?a(r,V.encoder):r;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||z.isBuffer(d))return a?[p(f?r:a(r,V.encoder))+"="+p(a(d,V.encoder))]:[p(r)+"="+p(String(d))];var v,g=[];if(void 0===d)return g;if(Array.isArray(s))v=s;else{var y=Object.keys(d);v=c?y.sort(c):y}for(var h=0;h<v.length;++h){var m=v[h];i&&null===d[m]||(g=Array.isArray(d)?g.concat(e(d[m],n(r,m),n,o,i,a,s,c,u,l,p,f)):g.concat(e(d[m],r+(u?"."+m:"["+m+"]"),n,o,i,a,s,c,u,l,p,f)))}return g},M=Object.prototype.hasOwnProperty,Q={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:z.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},W=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(n),a=i?n.slice(0,i.index):n,s=[];if(a){if(!r.plainObjects&&M.call(Object.prototype,a)&&!r.allowPrototypes)return;s.push(a)}for(var c=0;null!==(i=o.exec(n))&&c<r.depth;){if(c+=1,!r.plainObjects&&M.call(Object.prototype,i[1].slice(1,-1))&&!r.allowPrototypes)return;s.push(i[1])}return i&&s.push("["+n.slice(i.index)+"]"),function(e,t,r){for(var n=t,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a)i=(i=[]).concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n}n=i}return n}(s,t,r)}},X={formats:_,parse:function(e,t){var r=t?z.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||z.isRegExp(r.delimiter)?r.delimiter:Q.delimiter,r.depth="number"==typeof r.depth?r.depth:Q.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:Q.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:Q.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:Q.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:Q.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:Q.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:Q.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:Q.strictNullHandling,""===e||null===e||void 0===e)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof e?function(e,t){for(var r={},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=t.parameterLimit===1/0?void 0:t.parameterLimit,i=n.split(t.delimiter,o),a=0;a<i.length;++a){var s,c,u=i[a],l=u.indexOf("]="),p=-1===l?u.indexOf("="):l+1;-1===p?(s=t.decoder(u,Q.decoder),c=t.strictNullHandling?null:""):(s=t.decoder(u.slice(0,p),Q.decoder),c=t.decoder(u.slice(p+1),Q.decoder)),M.call(r,s)?r[s]=[].concat(r[s]).concat(c):r[s]=c}return r}(e,r):e,o=r.plainObjects?Object.create(null):{},i=Object.keys(n),a=0;a<i.length;++a){var s=i[a],c=W(s,n[s],r);o=z.merge(o,c,r)}return z.compact(o)},stringify:function(e,t){var r=e,n=t?z.assign({},t):{};if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var o=void 0===n.delimiter?V.delimiter:n.delimiter,i="boolean"==typeof n.strictNullHandling?n.strictNullHandling:V.strictNullHandling,a="boolean"==typeof n.skipNulls?n.skipNulls:V.skipNulls,s="boolean"==typeof n.encode?n.encode:V.encode,c="function"==typeof n.encoder?n.encoder:V.encoder,u="function"==typeof n.sort?n.sort:null,l=void 0!==n.allowDots&&n.allowDots,p="function"==typeof n.serializeDate?n.serializeDate:V.serializeDate,f="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:V.encodeValuesOnly;if(void 0===n.format)n.format=_.default;else if(!Object.prototype.hasOwnProperty.call(_.formatters,n.format))throw new TypeError("Unknown format option provided.");var d,v,g=_.formatters[n.format];"function"==typeof n.filter?r=(v=n.filter)("",r):Array.isArray(n.filter)&&(d=v=n.filter);var y,h=[];if("object"!=typeof r||null===r)return"";y=n.arrayFormat in F?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var m=F[y];d||(d=Object.keys(r)),u&&d.sort(u);for(var b=0;b<d.length;++b){var S=d[b];a&&null===r[S]||(h=h.concat(J(r[S],S,m,i,a,s?c:null,v,u,l,p,g,f)))}var O=h.join(o),w=!0===n.addQueryPrefix?"?":"";return O.length>0?w+O:""}};function $(e){return function(t){var r={};return r[e]=t,this&&this.compose?this.compose(r):B(r)}}var Y=$("properties"),Z=$("staticProperties"),ee=$("configuration"),te=$("deepProperties"),re=$("staticDeepProperties"),ne=$("deepConfiguration"),oe=$("initializers"),ie=B({staticProperties:{methods:$("methods"),props:Y,properties:Y,statics:Z,staticProperties:Z,conf:ee,configuration:ee,deepProps:te,deepProperties:te,deepStatics:re,staticDeepProperties:re,deepConf:ne,deepConfiguration:ne,init:oe,initializers:oe,composers:$("composers"),propertyDescriptors:$("propertyDescriptors"),staticPropertyDescriptors:$("staticPropertyDescriptors")}}),ae=Array.prototype.concat;function se(){var e=ae.apply([],arguments).filter(j);return 0===e.length?void 0:e}function ce(e){if(!A(e))return e;var t=e.methods,r=e.properties,n=e.props,o=e.initializers,i=e.init,a=e.composers,s=e.deepProperties,c=e.deepProps,u=e.propertyDescriptors,l=e.staticProperties,p=e.statics,f=e.staticDeepProperties,d=e.deepStatics,v=e.staticPropertyDescriptors,g=e.configuration,y=e.conf,h=e.deepConfiguration,m=e.deepConf,b=A(n)||A(r)?L({},n,r):void 0,S=A(c)?x({},c):void 0;S=A(s)?x(S,s):S;var O=A(p)||A(l)?L({},p,l):void 0,w=A(d)?x({},d):void 0;w=A(f)?x(w,f):w;var j=A(y)||A(g)?L({},y,g):void 0,P=A(m)?x({},m):void 0;P=A(h)?x(P,h):P;var D=se(i,o),T=se(a),K={};return t&&(K.methods=t),b&&(K.properties=b),D&&(K.initializers=D),T&&(K.composers=T),S&&(K.deepProperties=S),O&&(K.staticProperties=O),w&&(K.staticDeepProperties=w),u&&(K.propertyDescriptors=u),v&&(K.staticPropertyDescriptors=v),j&&(K.configuration=j),P&&(K.deepConfiguration=P),K}function ue(){for(var e=arguments,t=arguments.length,r=[],n=0;n<t;n+=1){var o=e[n];r.push(P(o)?o:ce(o))}return B.apply(this||le,r)}var le=ie.compose({staticProperties:{create:function(){return this.apply(this,arguments)},compose:ue}}),pe=ie.compose.staticProperties;for(var fe in pe)ue[fe]=pe[fe].bind(le);ue.compose=ue.bind();var de=ue,ve="function"==typeof fetch?fetch.bind():function(e,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest;for(var i in o.open(t.method||"get",e),t.headers)o.setRequestHeader(i,t.headers[i]);function a(){var e,t=[],r=[],n={};return o.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(o,i,a){t.push(i=i.toLowerCase()),r.push([i,a]),e=n[i],n[i]=e?e+","+a:a}),{ok:1==(o.status/200|0),status:o.status,statusText:o.statusText,url:o.responseURL,clone:a,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},headers:{keys:function(){return t},entries:function(){return r},get:function(e){return n[e.toLowerCase()]},has:function(e){return e.toLowerCase()in n}}}}o.withCredentials="include"==t.credentials,o.onload=function(){r(a())},o.onerror=n,o.send(t.body)})},ge=Object.freeze({default:ve}),ye=ge&&ve||ge,he=window.fetch||(window.fetch=ye.default||ye),me={accept:"application/json"},be=function(e,t){var r=t.target;void 0===r&&(r="https://api.one.accedo.tv");var n=e.split("?");return""+r+n[0]+"?"+function(e,t){void 0===t&&(t={});var r=e.sessionKey?{}:{appKey:e.appKey,uuid:e.deviceId};e.gid&&(r.gid=e.gid);var n=Object.assign({},t,r);return X.stringify(n)}(t,X.parse(n[1]))},Se=function(e){return Object.assign({},(t=e.ip)?{"X-FORWARDED-FOR":t}:{},function(e){var t=e.sessionKey;return t?{"X-SESSION":t}:{}}(e));var t},Oe=function(e,t){return t.log("Requesting",e),function(e,t){var r=Object.assign({},me,Se(t)),n=be(e,t);return t.log("Sending a GET request to: "+n+" with the following headers",r),he(n,{credentials:"same-origin",headers:r}).then(function(e){if(e.status>=400)throw t.log("GET failed with status",e.status),e;return e})}(e,t).then(function(e){return e.json()}).then(function(e){return t.log("GET response",e),e})},we=function(e,t,r,n){void 0===r&&(r={});var o=Object.assign({},me,{"Content-Type":"application/json"},Se(t)),i=be(e,t);t.log("Sending a POST request to: "+i+". With the following headers and body: ",o,r);var a={headers:o,credentials:"same-origin",method:"post",body:n?r:JSON.stringify(r)};return he(i,a).then(function(e){var r=e.status,n=e.statusText;if(200!==r)throw new Error("Accedo One POST request returned a non-200 response. Status Code: "+r+". Status Text: "+n);var o={status:r,statusText:n};return t.log("POST response: ",o),o})},je=Oe,Ae=de({init:function(e,t){var r,n=t.instance;n.createSession=function(){return r||(n.config.sessionKey&&(n.config.sessionKey=null),r=je("/session",n.config).then(function(e){var t=e.sessionKey;return n.config.sessionKey=t,r=null,t}).catch(function(e){throw r=null,e}))}},methods:{getSessionKey:function(){return this.config.sessionKey},withSessionHandling:function(e){var t=this;return this.getSessionKey()?e().catch(function(r){if(r&&401===r.status)return t.createSession().then(e);throw r}):this.createSession().then(e)}}}),Pe=Oe;function De(e,t){var r=this,n=function(e,t){void 0===t&&(t={});var r=t.id,n=t.typeId,o=t.alias,i=t.typeAlias,a=t.preview,s=t.at,c=t.offset,u=t.size,l=t.locale,p={};return r&&Array.isArray(r)&&(p.id=r.join(",")),o&&Array.isArray(o)&&(p.alias=o.join(",")),n&&Array.isArray(n)&&(p.typeId=n.join(",")),a&&(p.preview=!0),"string"==typeof s?p.at=s:s&&s.toISOString&&(p.at=s.toISOString()),e+"?"+X.stringify(Object.assign({},p,{typeAlias:i,offset:c,size:u,locale:l}))}(e,t);return this.withSessionHandling(function(){return Pe(n,r.config)})}var Le=Ae.compose({methods:{getEntries:function(e){return De.call(this,"/content/entries",e)},getEntryById:function(e,t){return De.call(this,"/content/entry/"+e,t)},getEntryByAlias:function(e,t){return De.call(this,"/content/entry/alias/"+e,t)}}}),Te=Oe,Ke=Ae.compose({methods:{getApplicationStatus:function(){var e=this;return this.withSessionHandling(function(){return Te("/status",e.config)})}}}),xe=Oe,Ee=Ae.compose({methods:{getAllAssets:function(){var e=this;return this.withSessionHandling(function(){return xe("/asset",e.config)})}}}),Ce=we;function Ie(e,t){var r=this,n={eventType:e};return void 0!==t&&(n.retentionTime=t),this.withSessionHandling(function(){return Ce("/event/log",r.config,n)})}var ke=Ae.compose({methods:{sendUsageStartEvent:function(){return Ie.call(this,"START")},sendUsageStopEvent:function(e){return Ie.call(this,"QUIT",e)}}}),He=Oe,Re=Ae.compose({methods:{getAllEnabledPlugins:function(){var e=this;return this.withSessionHandling(function(){return He("/plugins",e.config)})}}}),Ne=Oe,Be=Ae.compose({methods:{getProfileInfo:function(){var e=this;return this.withSessionHandling(function(){return Ne("/profile",e.config)})}}}),ze=!1;try{ze="undefined"!=typeof localStorage}catch(e){}var Ue=Oe,qe=function(e){var t=e.key,r=e.value;if(ze)try{var n=JSON.stringify(r),o=(new Date).getTime();console.log("Save data",r),localStorage[t]=n,localStorage[t+"Timestamp"]=o+6e4}catch(e){console.log(e,"save meta")}else console.log("local storage not found in save metadata")},_e=function(e){var t=e.key;if(!ze)return console.log("local storage not found in load metadata"),!0;try{if(!localStorage[t])return;var r=localStorage[t+"Timestamp"],n=(new Date).getTime(),o=JSON.parse(localStorage[t]);return console.log("LOAD DATA:",o),n<r&&o}catch(e){return void console.log(e,"load meta")}};function Fe(e){var t=this;return this.withSessionHandling(function(){return Ue(e,t.config)})}var Ge=Ae.compose({methods:{getAllMetadata:function(){var e=_e({key:"metadata_all"});return e?Promise.resolve(e):Fe.call(this,"/metadata").then(function(e){return console.log("metadata in getall"),qe({key:"metadata",value:e}),e})},getMetadataByKey:function(e){var t=e+"_metadata",r=_e({key:t});return r?Promise.resolve(r):Fe.call(this,"/metadata/"+e).then(function(e){return console.log("metadata in getall with key"),qe({key:t,value:e}),e})},getMetadataByKeys:function(e){var t=e.join(",")+"_metadata",r=_e({key:t});return r?Promise.resolve(r):Fe.call(this,"/metadata/"+e.join(",")).then(function(e){return console.log("GET metadatas by keys"),qe({key:t,value:e}),e})}}}),Ve=Oe,Je=we;function Me(e){var t=this;return this.withSessionHandling(function(){return Ve(e,t.config)})}function Qe(e,t){var r=this;return this.withSessionHandling(function(){return Je(e,r.config,t)})}function We(e,t){return Me.call(this,"/"+e+"/"+t)}function Xe(e,t,r){return Me.call(this,"/"+e+"/"+t+"/"+r+"?json=true")}function $e(e,t,r){return Qe.call(this,"/"+e+"/"+t,r)}function Ye(e,t,r,n){return Qe.call(this,"/"+e+"/"+t+"/"+r,n)}var Ze=Ae.compose({methods:{getAllApplicationScopeDataByUser:function(e){return We.call(this,"user",e)},getAllApplicationGroupScopeDataByUser:function(e){return We.call(this,"group",e)},getApplicationScopeDataByUserAndKey:function(e,t){return Xe.call(this,"user",e,t)},getApplicationGroupScopeDataByUserAndKey:function(e,t){return Xe.call(this,"group",e,t)},setApplicationScopeUserData:function(e,t){return $e.call(this,"user",e,t)},setApplicationGroupScopeUserData:function(e,t){return $e.call(this,"group",e,t)},setApplicationScopeUserDataByKey:function(e,t,r){return Ye.call(this,"user",e,t,r)},setApplicationGroupScopeUserDataByKey:function(e,t,r){return Ye.call(this,"group",e,t,r)}}}),et=Oe,tt=Ae.compose({methods:{getAvailableLocales:function(){var e=this;return this.withSessionHandling(function(){return et("/locales",e.config)})}}}),rt=Oe,nt=we,ot=["debug","info","warn","error"],it=function(e,t){void 0===e&&(e={});var r=function(e,t){return t?JSON.stringify([e,t]):e}(e.message,t);return{code:e.errorCode||0,message:r,dim1:e.dim1,dim2:e.dim2,dim3:e.dim3,dim4:e.dim4}};var at=Ae.compose({init:function(e,t){var r,n=t.instance,o={};n.getLogLevel=function(){if(r)return r;var e=o.logLevel,t=o.timestamp;return void 0===t&&(t=0),Date.now()-t<18e4?Promise.resolve(e):r=function(e){var t=this;return this.withSessionHandling(function(){return rt(e,t.config)})}.call(n,"/application/log/level").then(function(e){var t=e.logLevel;return r=null,o={logLevel:t,timestamp:Date.now()},t}).catch(function(e){throw r=null,e})}},methods:{sendLogs:function(e){var t=e.map(function(e){var t=e.logType,r=e.timestamp;return Object.assign(it(e,e.metadata),{logType:t,timestamp:r})});return function(e){var t=this;return this.withSessionHandling(function(){return nt("/application/logs",t.config,e)})}.call(this,t)}}}),st=at;at.getLogEvent=it,at.ALLOWED_LEVELS=ot;var ct=B(Ae,Le,Ke,Ee,ke,Re,Be,Ge,Ze,tt,st),ut=we,lt=st.ALLOWED_LEVELS,pt=st.getLogEvent,ft=lt.concat(["off"]);var dt=Ae.compose(st,{init:function(e,t){var r=t.instance,n={data:[],totalLength:0,timeoutID:void 0},o=function(){(function(e){var t=this,r=e.data,n=e.timeoutID;return clearTimeout(n),r.length?this.withSessionHandling(function(){return ut("/application/logs",t.config,"["+r.join(",")+"]",!0)}).catch(function(e){throw t.config.log("The batched logs could not be sent. "+r.length+" logs lost",e),e}):Promise.resolve()}).call(r,n),n={data:[],totalLength:0,timeoutID:void 0}},i=function(e){n.data.push(e),n.totalLength+=e.length,clearTimeout(n.timeoutID),n.timeoutID=setTimeout(o,12e4)};!function(e){try{window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})}catch(e){console.error("Accedo One SDK event listeners could not be attached",e)}}(o),r.sendLog=function(e,t){for(var a=[],s=arguments.length-2;s-- >0;)a[s]=arguments[s+2];return lt.includes(e)?r.getLogLevel().then(function(r){if(ft.indexOf(r)>ft.indexOf(e))return Promise.resolve({status:200,statusText:"Request avoided",requestAvoided:!0});var s=a.length?1===a.length?a[0]:a:void 0,c=JSON.stringify(Object.assign(pt(t,s),{logType:e,timestamp:Date.now()})),u=c.length;if(u>2e6)return Promise.reject({status:400,statusText:"Request oversized"});var l=n.totalLength;if(l+u<2e5)i(c);else{var p=l+u>2e6;p||i(c),o(),p&&i(c)}return Promise.resolve({status:200,statusText:"Request queued for batch",requestQueued:!0})}):Promise.reject("Unsupported log level")}}});return O(ct.compose(dt))});
